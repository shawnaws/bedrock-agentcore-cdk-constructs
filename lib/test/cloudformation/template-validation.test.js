"use strict";
/**
 * CloudFormation Template Validation Tests
 *
 * This test suite validates the CloudFormation templates generated by our constructs
 * to ensure they follow AWS best practices, security principles, and proper resource
 * naming conventions.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = __importStar(require("aws-cdk-lib"));
const assertions_1 = require("aws-cdk-lib/assertions");
const aws_s3_1 = require("aws-cdk-lib/aws-s3");
const bedrock_agentcore_runtime_agent_1 = require("../../src/constructs/bedrock-agentcore/bedrock-agentcore-runtime-agent");
const bedrock_knowledge_base_1 = require("../../src/constructs/bedrock/bedrock-knowledge-base");
describe('CloudFormation Template Validation', () => {
    let app;
    let stack;
    let testBucket;
    beforeEach(() => {
        app = new cdk.App();
        stack = new cdk.Stack(app, 'TestStack', {
            env: {
                account: '123456789012',
                region: 'us-east-1'
            }
        });
        testBucket = new aws_s3_1.Bucket(stack, 'TestBucket');
    });
    describe('CloudFormation Template Snapshots', () => {
        test('should generate consistent template for BedrockAgentCoreRuntimeAgent', () => {
            // Create a minimal knowledge base for the agent
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'MinimalKB', {
                name: 'minimal-kb',
                description: 'Minimal knowledge base for agent testing',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['minimal/'],
                knowledgeBaseInstructions: 'Minimal knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Create snapshot of the template
            expect(template.toJSON()).toMatchSnapshot('bedrock-agent-core-runtime-template');
            expect(agent.agentName).toBe('test-agent');
        });
        test('should generate consistent template for BedrockKnowledgeBase', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const template = assertions_1.Template.fromStack(stack);
            // Create snapshot of the template
            expect(template.toJSON()).toMatchSnapshot('bedrock-knowledge-base-template');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should generate consistent template for integrated constructs', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant with knowledge base access',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Create snapshot of the integrated template
            expect(template.toJSON()).toMatchSnapshot('integrated-bedrock-constructs-template');
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
    });
    describe('IAM Policy Validation - Least Privilege Principles', () => {
        test('should create IAM policies with minimal required permissions for agent', () => {
            // Create a minimal knowledge base for the agent
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'MinimalKB', {
                name: 'minimal-kb',
                description: 'Minimal knowledge base for agent testing',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['minimal/'],
                knowledgeBaseInstructions: 'Minimal knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Verify IAM role has correct trust policy
            template.hasResourceProperties('AWS::IAM::Role', {
                AssumeRolePolicyDocument: {
                    Statement: [
                        {
                            Action: 'sts:AssumeRole',
                            Effect: 'Allow',
                            Principal: {
                                Service: 'bedrock-agentcore.amazonaws.com'
                            },
                            Condition: {
                                StringEquals: {
                                    'aws:SourceAccount': '123456789012'
                                },
                                ArnLike: {
                                    'aws:SourceArn': 'arn:aws:bedrock-agentcore:us-east-1:123456789012:*'
                                }
                            }
                        }
                    ]
                }
            });
            // Verify IAM policy has only required permissions
            template.hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: assertions_1.Match.arrayWith([
                        // Bedrock permissions
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: [
                                'bedrock:InvokeModel',
                                'bedrock:InvokeModelWithResponseStream'
                            ],
                            Resource: '*',
                            Sid: 'BedrockPermissions'
                        }),
                        // S3 permissions scoped to specific bucket and prefix
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: [
                                's3:GetObject',
                                's3:PutObject',
                                's3:DeleteObject',
                                's3:ListBucket'
                            ],
                            Sid: 'S3DataStorage'
                        })
                    ])
                }
            });
            expect(agent.agentName).toBe('test-agent');
        });
        test('should create IAM policies with knowledge base permissions when needed', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant with knowledge base access',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Verify agent has knowledge base permissions
            template.hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: assertions_1.Match.arrayWith([
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: [
                                'bedrock:Retrieve',
                                'bedrock:RetrieveAndGenerate'
                            ]
                        }),
                        // OpenSearch Serverless permissions for knowledge base access
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: 'aoss:APIAccessAll'
                        })
                    ])
                }
            });
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should create knowledge base IAM policies with minimal permissions', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/', 'policies/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const template = assertions_1.Template.fromStack(stack);
            // Verify knowledge base data source role has correct permissions
            template.hasResourceProperties('AWS::IAM::Policy', {
                PolicyDocument: {
                    Statement: assertions_1.Match.arrayWith([
                        // Bedrock embedding permissions
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: [
                                'bedrock:InvokeModel*',
                                'bedrock:GetFoundationModel'
                            ]
                        }),
                        // S3 permissions scoped to specific prefixes
                        assertions_1.Match.objectLike({
                            Effect: 'Allow',
                            Action: [
                                's3:GetObject*',
                                's3:GetBucket*',
                                's3:List*'
                            ]
                        })
                    ])
                }
            });
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
    });
    describe('Template Synthesis with Different Configurations', () => {
        test('should handle minimal configuration', () => {
            // Create a minimal knowledge base for the agent
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'MinimalKB', {
                name: 'minimal-kb',
                description: 'Minimal knowledge base for agent testing',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['minimal/'],
                knowledgeBaseInstructions: 'Minimal knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'MinimalAgent', {
                agentName: 'minimal-agent',
                instruction: 'Minimal configuration agent',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'minimal/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Should create basic resources including the knowledge base
            const roleCount = Object.keys(template.findResources('AWS::IAM::Role')).length;
            const policyCount = Object.keys(template.findResources('AWS::IAM::Policy')).length;
            expect(roleCount).toBeGreaterThanOrEqual(1);
            expect(policyCount).toBeGreaterThanOrEqual(1);
            template.resourceCountIs('Custom::AgentCoreRuntime', 1);
            // Should create knowledge base resources
            template.resourceCountIs('AWS::Bedrock::KnowledgeBase', 1);
            template.resourceCountIs('AWS::OpenSearchServerless::Collection', 1);
            expect(agent.agentName).toBe('minimal-agent');
        });
        test('should handle maximum configuration', () => {
            const knowledgeBase1 = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'KB1', {
                name: 'kb-1',
                description: 'First knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['docs/'],
                knowledgeBaseInstructions: 'Use for documentation',
                chunkingStrategy: {
                    maxTokens: 1500,
                    overlapPercentage: 25
                },
                enableIngestionAlarms: true,
                environment: 'prod'
            });
            const knowledgeBase2 = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'KB2', {
                name: 'kb-2',
                description: 'Second knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['policies/'],
                knowledgeBaseInstructions: 'Use for policies',
                chunkingStrategy: {
                    maxTokens: 800,
                    overlapPercentage: 15
                },
                enableIngestionAlarms: true,
                environment: 'prod'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'MaximalAgent', {
                agentName: 'maximal-agent',
                instruction: 'Maximal configuration agent with all features',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'maximal/',
                knowledgeBases: [knowledgeBase1, knowledgeBase2],
                protocol: 'HTTPS',
                environment: 'prod',
                enableTracing: true,
                customResourceTimeoutMinutes: 20,
                environmentVars: {
                    'CUSTOM_VAR': 'custom-value',
                    'DEBUG_MODE': 'true'
                }
            });
            const template = assertions_1.Template.fromStack(stack);
            // Should create all resources
            template.resourceCountIs('AWS::Bedrock::KnowledgeBase', 2);
            template.resourceCountIs('AWS::Bedrock::DataSource', 2);
            template.resourceCountIs('AWS::OpenSearchServerless::Collection', 2);
            template.resourceCountIs('AWS::StepFunctions::StateMachine', 2);
            template.resourceCountIs('AWS::Events::Rule', 2);
            template.resourceCountIs('AWS::CloudWatch::Alarm', 6); // 3 per KB
            template.resourceCountIs('Custom::AgentCoreRuntime', 1);
            // Should have production log retention
            template.hasResourceProperties('AWS::Logs::LogGroup', {
                RetentionInDays: 180
            });
            expect(agent.agentName).toBe('maximal-agent');
            expect(knowledgeBase1.knowledgeBaseName).toBe('kb-1');
            expect(knowledgeBase2.knowledgeBaseName).toBe('kb-2');
        });
        test('should handle different environment configurations', () => {
            // Test each environment separately to avoid synthesis conflicts
            const testEnvironment = (env) => {
                const envApp = new cdk.App();
                const envStack = new cdk.Stack(envApp, `${env}Stack`, {
                    env: {
                        account: '123456789012',
                        region: 'us-east-1'
                    }
                });
                const envBucket = new aws_s3_1.Bucket(envStack, 'EnvBucket');
                const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(envStack, 'EnvKB', {
                    name: `${env}-kb`,
                    description: `${env} knowledge base`,
                    dataSourceBucket: envBucket,
                    dataSourcePrefixes: ['documents/'],
                    knowledgeBaseInstructions: `${env} knowledge base instructions`,
                    environment: env
                });
                const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(envStack, 'EnvAgent', {
                    agentName: `${env}-agent`,
                    instruction: `${env} agent instructions`,
                    projectRoot: './test-project',
                    s3Bucket: envBucket,
                    s3Prefix: `${env}-data/`,
                    knowledgeBases: [knowledgeBase],
                    environment: env
                });
                const template = assertions_1.Template.fromStack(envStack);
                // Verify environment-specific configurations
                const expectedRetention = env === 'prod' ? 180 : env === 'staging' ? 30 : 7;
                template.hasResourceProperties('AWS::Logs::LogGroup', {
                    RetentionInDays: expectedRetention
                });
                // Production should have alarms, dev should not
                const expectedAlarmCount = env === 'prod' ? 3 : 0;
                template.resourceCountIs('AWS::CloudWatch::Alarm', expectedAlarmCount);
                expect(agent.agentName).toBe(`${env}-agent`);
                expect(knowledgeBase.knowledgeBaseName).toBe(`${env}-kb`);
            };
            // Test each environment
            testEnvironment('dev');
            testEnvironment('staging');
            testEnvironment('prod');
        });
    });
    describe('Resource Naming Conventions and Tagging', () => {
        test('should follow consistent naming conventions', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Verify IAM role naming follows convention
            template.hasResourceProperties('AWS::IAM::Role', {
                RoleName: assertions_1.Match.absent() // Should use CDK generated names
            });
            // Verify knowledge base naming (CDK generates unique names)
            template.hasResourceProperties('AWS::Bedrock::KnowledgeBase', {
                Name: assertions_1.Match.stringLikeRegexp('^.*test-kb.*$')
            });
            // Verify OpenSearch collection naming follows convention
            template.hasResourceProperties('AWS::OpenSearchServerless::Collection', {
                Name: assertions_1.Match.stringLikeRegexp('^vectorstore.*$')
            });
            // Verify Step Functions state machine naming
            template.hasResourceProperties('AWS::StepFunctions::StateMachine', {
                StateMachineName: assertions_1.Match.stringLikeRegexp('.*ingestion.*')
            });
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should apply consistent resource tagging', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing',
                environment: 'prod'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase],
                environment: 'prod'
            });
            const template = assertions_1.Template.fromStack(stack);
            // Verify resources have appropriate tags (note: not all resources support tags)
            // Check that the knowledge base has tags if they are supported
            const kbResources = template.findResources('AWS::Bedrock::KnowledgeBase');
            const kbKeys = Object.keys(kbResources);
            if (kbKeys.length > 0) {
                // Knowledge bases may or may not have tags depending on the CDK version
                // Just verify the resource exists with the expected properties
                expect(kbResources[kbKeys[0]].Properties).toHaveProperty('Name');
                expect(kbResources[kbKeys[0]].Properties).toHaveProperty('Description');
            }
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should handle resource naming conflicts gracefully', () => {
            // Create multiple knowledge bases with similar names
            const kb1 = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'KB1', {
                name: 'test-kb',
                description: 'First test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['docs1/'],
                knowledgeBaseInstructions: 'First KB instructions'
            });
            const kb2 = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'KB2', {
                name: 'test-kb-2',
                description: 'Second test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['docs2/'],
                knowledgeBaseInstructions: 'Second KB instructions'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'Agent with multiple similar KBs',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [kb1, kb2]
            });
            const template = assertions_1.Template.fromStack(stack);
            // Should create both knowledge bases with unique resource names
            template.resourceCountIs('AWS::Bedrock::KnowledgeBase', 2);
            template.resourceCountIs('AWS::OpenSearchServerless::Collection', 2);
            // Verify unique collection names
            const collections = template.findResources('AWS::OpenSearchServerless::Collection');
            const collectionNames = Object.values(collections).map((collection) => collection.Properties.Name);
            // Names should be different
            expect(collectionNames[0]).not.toBe(collectionNames[1]);
            expect(collectionNames[0]).toMatch(/^vectorstore.*$/);
            expect(collectionNames[1]).toMatch(/^vectorstore.*$/);
            expect(agent.agentName).toBe('test-agent');
            expect(kb1.knowledgeBaseName).toBe('test-kb');
            expect(kb2.knowledgeBaseName).toBe('test-kb-2');
        });
    });
    describe('CloudFormation Template Structure Validation', () => {
        test('should generate valid CloudFormation template structure', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            const templateJson = template.toJSON();
            // Verify template has required sections (CDK templates don't always have AWSTemplateFormatVersion)
            expect(templateJson).toHaveProperty('Resources');
            expect(templateJson).toHaveProperty('Parameters');
            // CDK templates may have additional sections
            if (templateJson.AWSTemplateFormatVersion) {
                expect(templateJson.AWSTemplateFormatVersion).toBe('2010-09-09');
            }
            // Verify no hardcoded values in template
            const templateString = JSON.stringify(templateJson);
            expect(templateString).not.toMatch(/123456789012/); // No hardcoded account IDs
            expect(templateString).not.toMatch(/us-east-1/); // No hardcoded regions (except in ARNs)
            // Verify all resources have proper dependencies
            const resources = templateJson.Resources;
            Object.keys(resources).forEach(resourceKey => {
                const resource = resources[resourceKey];
                // IAM policies should depend on roles
                if (resource.Type === 'AWS::IAM::Policy') {
                    expect(resource.Properties.Roles).toBeDefined();
                }
                // Custom resources should have proper service tokens
                if (resource.Type.startsWith('Custom::')) {
                    expect(resource.Properties.ServiceToken).toBeDefined();
                }
            });
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should validate resource dependencies are correct', () => {
            const knowledgeBase = new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, 'TestKB', {
                name: 'test-kb',
                description: 'Test knowledge base',
                dataSourceBucket: testBucket,
                dataSourcePrefixes: ['documents/'],
                knowledgeBaseInstructions: 'Use this knowledge base for testing'
            });
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'TestAgent', {
                agentName: 'test-agent',
                instruction: 'You are a helpful assistant',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'agent-data/',
                knowledgeBases: [knowledgeBase]
            });
            const template = assertions_1.Template.fromStack(stack);
            const templateJson = template.toJSON();
            // Find data source resource
            const dataSourceKey = Object.keys(templateJson.Resources).find(key => templateJson.Resources[key].Type === 'AWS::Bedrock::DataSource');
            if (dataSourceKey) {
                const dataSource = templateJson.Resources[dataSourceKey];
                // Data source should depend on knowledge base
                expect(dataSource.Properties.KnowledgeBaseId).toBeDefined();
                // Should have proper S3 configuration
                expect(dataSource.Properties.DataSourceConfiguration.S3Configuration).toBeDefined();
            }
            // Find Step Functions state machine
            const stateMachineKey = Object.keys(templateJson.Resources).find(key => templateJson.Resources[key].Type === 'AWS::StepFunctions::StateMachine');
            if (stateMachineKey) {
                const stateMachine = templateJson.Resources[stateMachineKey];
                // State machine should have proper IAM role
                expect(stateMachine.Properties.RoleArn).toBeDefined();
                // Should have definition (may be inline or referenced)
                expect(stateMachine.Properties).toHaveProperty('DefinitionString');
            }
            expect(agent.agentName).toBe('test-agent');
            expect(knowledgeBase.knowledgeBaseName).toBe('test-kb');
        });
        test('should validate template size and complexity limits', () => {
            // Create a complex stack to test template limits
            const knowledgeBases = [];
            for (let i = 0; i < 3; i++) {
                knowledgeBases.push(new bedrock_knowledge_base_1.BedrockKnowledgeBase(stack, `KB${i}`, {
                    name: `kb-${i}`,
                    description: `Knowledge base ${i}`,
                    dataSourceBucket: testBucket,
                    dataSourcePrefixes: [`docs${i}/`],
                    knowledgeBaseInstructions: `Instructions for KB ${i}`,
                    enableIngestionAlarms: true
                }));
            }
            const agent = new bedrock_agentcore_runtime_agent_1.BedrockAgentCoreRuntimeAgent(stack, 'ComplexAgent', {
                agentName: 'complex-agent',
                instruction: 'Complex agent with multiple knowledge bases',
                projectRoot: './test-project',
                s3Bucket: testBucket,
                s3Prefix: 'complex-agent/',
                knowledgeBases: knowledgeBases,
                environment: 'prod',
                enableTracing: true
            });
            const template = assertions_1.Template.fromStack(stack);
            const templateJson = template.toJSON();
            const templateString = JSON.stringify(templateJson);
            // Verify template is within CloudFormation limits
            expect(templateString.length).toBeLessThan(1000000); // 1MB limit
            // Verify resource count is reasonable
            const resourceCount = Object.keys(templateJson.Resources).length;
            expect(resourceCount).toBeLessThan(500); // CloudFormation limit is 500
            // Verify no circular dependencies
            const resources = templateJson.Resources;
            Object.keys(resources).forEach(resourceKey => {
                const resource = resources[resourceKey];
                if (resource.DependsOn) {
                    const dependencies = Array.isArray(resource.DependsOn)
                        ? resource.DependsOn
                        : [resource.DependsOn];
                    // Resource should not depend on itself
                    expect(dependencies).not.toContain(resourceKey);
                }
            });
            expect(agent.agentName).toBe('complex-agent');
            expect(knowledgeBases.length).toBe(3);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVtcGxhdGUtdmFsaWRhdGlvbi50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vdGVzdC9jbG91ZGZvcm1hdGlvbi90ZW1wbGF0ZS12YWxpZGF0aW9uLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUFtQztBQUNuQyx1REFBeUQ7QUFDekQsK0NBQTRDO0FBQzVDLDRIQUFzSDtBQUN0SCxnR0FBMkY7QUFFM0YsUUFBUSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtJQUNoRCxJQUFJLEdBQVksQ0FBQztJQUNqQixJQUFJLEtBQWdCLENBQUM7SUFDckIsSUFBSSxVQUFrQixDQUFDO0lBRXZCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDcEIsS0FBSyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsV0FBVyxFQUFFO1lBQ3BDLEdBQUcsRUFBRTtnQkFDRCxPQUFPLEVBQUUsY0FBYztnQkFDdkIsTUFBTSxFQUFFLFdBQVc7YUFDdEI7U0FDSixDQUFDLENBQUM7UUFFSCxVQUFVLEdBQUcsSUFBSSxlQUFNLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxJQUFJLENBQUMsc0VBQXNFLEVBQUUsR0FBRyxFQUFFO1lBQzlFLGdEQUFnRDtZQUNoRCxNQUFNLGFBQWEsR0FBRyxJQUFJLDZDQUFvQixDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUU7Z0JBQy9ELElBQUksRUFBRSxZQUFZO2dCQUNsQixXQUFXLEVBQUUsMENBQTBDO2dCQUN2RCxnQkFBZ0IsRUFBRSxVQUFVO2dCQUM1QixrQkFBa0IsRUFBRSxDQUFDLFVBQVUs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QyxTQUFTLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEVBQUU7Z0JBQ3pDLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDeEMsSUFBSSxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7b0JBQ3JCLE1BQU0sWUFBWSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQzt3QkFDbEQsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTO3dCQUNwQixDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBRTNCLHVDQUF1QztvQkFDdkMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ3BELENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQztZQUVILE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2xvdWRGb3JtYXRpb24gVGVtcGxhdGUgVmFsaWRhdGlvbiBUZXN0c1xuICogXG4gKiBUaGlzIHRlc3Qgc3VpdGUgdmFsaWRhdGVzIHRoZSBDbG91ZEZvcm1hdGlvbiB0ZW1wbGF0ZXMgZ2VuZXJhdGVkIGJ5IG91ciBjb25zdHJ1Y3RzXG4gKiB0byBlbnN1cmUgdGhleSBmb2xsb3cgQVdTIGJlc3QgcHJhY3RpY2VzLCBzZWN1cml0eSBwcmluY2lwbGVzLCBhbmQgcHJvcGVyIHJlc291cmNlXG4gKiBuYW1pbmcgY29udmVudGlvbnMuXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IFRlbXBsYXRlLCBNYXRjaCB9IGZyb20gJ2F3cy1jZGstbGliL2Fzc2VydGlvbnMnO1xuaW1wb3J0IHsgQnVja2V0IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXMzJztcbmltcG9ydCB7IEJlZHJvY2tBZ2VudENvcmVSdW50aW1lQWdlbnQgfSBmcm9tICcuLi8uLi9zcmMvY29uc3RydWN0cy9iZWRyb2NrLWFnZW50Y29yZS9iZWRyb2NrLWFnZW50Y29yZS1ydW50aW1lLWFnZW50JztcbmltcG9ydCB7IEJlZHJvY2tLbm93bGVkZ2VCYXNlIH0gZnJvbSAnLi4vLi4vc3JjL2NvbnN0cnVjdHMvYmVkcm9jay9iZWRyb2NrLWtub3dsZWRnZS1iYXNlJztcblxuZGVzY3JpYmUoJ0Nsb3VkRm9ybWF0aW9uIFRlbXBsYXRlIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgbGV0IGFwcDogY2RrLkFwcDtcbiAgICBsZXQgc3RhY2s6IGNkay5TdGFjaztcbiAgICBsZXQgdGVzdEJ1Y2tldDogQnVja2V0O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgIGFwcCA9IG5ldyBjZGsuQXBwKCk7XG4gICAgICAgIHN0YWNrID0gbmV3IGNkay5TdGFjayhhcHAsICdUZXN0U3RhY2snLCB7XG4gICAgICAgICAgICBlbnY6IHtcbiAgICAgICAgICAgICAgICBhY2NvdW50OiAnMTIzNDU2Nzg5MDEyJyxcbiAgICAgICAgICAgICAgICByZWdpb246ICd1cy1lYXN0LTEnXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgdGVzdEJ1Y2tldCA9IG5ldyBCdWNrZXQoc3RhY2ssICdUZXN0QnVja2V0Jyk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnQ2xvdWRGb3JtYXRpb24gVGVtcGxhdGUgU25hcHNob3RzJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgZ2VuZXJhdGUgY29uc2lzdGVudCB0ZW1wbGF0ZSBmb3IgQmVkcm9ja0FnZW50Q29yZVJ1bnRpbWVBZ2VudCcsICgpID0+IHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIG1pbmltYWwga25vd2xlZGdlIGJhc2UgZm9yIHRoZSBhZ2VudFxuICAgICAgICAgICAgY29uc3Qga25vd2xlZGdlQmFzZSA9IG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShzdGFjaywgJ01pbmltYWxLQicsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnbWluaW1hbC1rYicsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdNaW5pbWFsIGtub3dsZWRnZSBiYXNlIGZvciBhZ2VudCB0ZXN0aW5nJyxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VQcmVmaXhlczogWydtaW5pbWFsLyddLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6ICdNaW5pbWFsIGtub3dsZWRnZSBiYXNlIGZvciB0ZXN0aW5nJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gbmV3IEJlZHJvY2tBZ2VudENvcmVSdW50aW1lQWdlbnQoc3RhY2ssICdUZXN0QWdlbnQnLCB7XG4gICAgICAgICAgICAgICAgYWdlbnROYW1lOiAndGVzdC1hZ2VudCcsXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb246ICdZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQnLFxuICAgICAgICAgICAgICAgIHByb2plY3RSb290OiAnLi90ZXN0LXByb2plY3QnLFxuICAgICAgICAgICAgICAgIHMzQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgIHMzUHJlZml4OiAnYWdlbnQtZGF0YS8nLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VzOiBba25vd2xlZGdlQmFzZV1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBzbmFwc2hvdCBvZiB0aGUgdGVtcGxhdGVcbiAgICAgICAgICAgIGV4cGVjdCh0ZW1wbGF0ZS50b0pTT04oKSkudG9NYXRjaFNuYXBzaG90KCdiZWRyb2NrLWFnZW50LWNvcmUtcnVudGltZS10ZW1wbGF0ZScpO1xuICAgICAgICAgICAgZXhwZWN0KGFnZW50LmFnZW50TmFtZSkudG9CZSgndGVzdC1hZ2VudCcpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgZ2VuZXJhdGUgY29uc2lzdGVudCB0ZW1wbGF0ZSBmb3IgQmVkcm9ja0tub3dsZWRnZUJhc2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IEJlZHJvY2tLbm93bGVkZ2VCYXNlKHN0YWNrLCAnVGVzdEtCJywge1xuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0LWtiJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3Qga25vd2xlZGdlIGJhc2UnLFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZVByZWZpeGVzOiBbJ2RvY3VtZW50cy8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnVXNlIHRoaXMga25vd2xlZGdlIGJhc2UgZm9yIHRlc3RpbmcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgc25hcHNob3Qgb2YgdGhlIHRlbXBsYXRlXG4gICAgICAgICAgICBleHBlY3QodGVtcGxhdGUudG9KU09OKCkpLnRvTWF0Y2hTbmFwc2hvdCgnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS10ZW1wbGF0ZScpO1xuICAgICAgICAgICAgZXhwZWN0KGtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGdlbmVyYXRlIGNvbnNpc3RlbnQgdGVtcGxhdGUgZm9yIGludGVncmF0ZWQgY29uc3RydWN0cycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdUZXN0S0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3Qta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jdW1lbnRzLyddLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6ICdVc2UgdGhpcyBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnVGVzdEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ3Rlc3QtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50IHdpdGgga25vd2xlZGdlIGJhc2UgYWNjZXNzJyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ2FnZW50LWRhdGEvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDcmVhdGUgc25hcHNob3Qgb2YgdGhlIGludGVncmF0ZWQgdGVtcGxhdGVcbiAgICAgICAgICAgIGV4cGVjdCh0ZW1wbGF0ZS50b0pTT04oKSkudG9NYXRjaFNuYXBzaG90KCdpbnRlZ3JhdGVkLWJlZHJvY2stY29uc3RydWN0cy10ZW1wbGF0ZScpO1xuICAgICAgICAgICAgZXhwZWN0KGFnZW50LmFnZW50TmFtZSkudG9CZSgndGVzdC1hZ2VudCcpO1xuICAgICAgICAgICAgZXhwZWN0KGtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2InKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnSUFNIFBvbGljeSBWYWxpZGF0aW9uIC0gTGVhc3QgUHJpdmlsZWdlIFByaW5jaXBsZXMnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgSUFNIHBvbGljaWVzIHdpdGggbWluaW1hbCByZXF1aXJlZCBwZXJtaXNzaW9ucyBmb3IgYWdlbnQnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBtaW5pbWFsIGtub3dsZWRnZSBiYXNlIGZvciB0aGUgYWdlbnRcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdNaW5pbWFsS0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ21pbmltYWwta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTWluaW1hbCBrbm93bGVkZ2UgYmFzZSBmb3IgYWdlbnQgdGVzdGluZycsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnbWluaW1hbC8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnTWluaW1hbCBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnVGVzdEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ3Rlc3QtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ2FnZW50LWRhdGEvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuXG4gICAgICAgICAgICAvLyBWZXJpZnkgSUFNIHJvbGUgaGFzIGNvcnJlY3QgdHJ1c3QgcG9saWN5XG4gICAgICAgICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpSb2xlJywge1xuICAgICAgICAgICAgICAgIEFzc3VtZVJvbGVQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgICAgICAgICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3Rpb246ICdzdHM6QXNzdW1lUm9sZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByaW5jaXBhbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlOiAnYmVkcm9jay1hZ2VudGNvcmUuYW1hem9uYXdzLmNvbSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmRpdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmdFcXVhbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhd3M6U291cmNlQWNjb3VudCc6ICcxMjM0NTY3ODkwMTInXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhd3M6U291cmNlQXJuJzogJ2Fybjphd3M6YmVkcm9jay1hZ2VudGNvcmU6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjoqJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBJQU0gcG9saWN5IGhhcyBvbmx5IHJlcXVpcmVkIHBlcm1pc3Npb25zXG4gICAgICAgICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6SUFNOjpQb2xpY3knLCB7XG4gICAgICAgICAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgU3RhdGVtZW50OiBNYXRjaC5hcnJheVdpdGgoW1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmVkcm9jayBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmVkcm9jazpJbnZva2VNb2RlbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiZWRyb2NrOkludm9rZU1vZGVsV2l0aFJlc3BvbnNlU3RyZWFtJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzb3VyY2U6ICcqJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaWQ6ICdCZWRyb2NrUGVybWlzc2lvbnMnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFMzIHBlcm1pc3Npb25zIHNjb3BlZCB0byBzcGVjaWZpYyBidWNrZXQgYW5kIHByZWZpeFxuICAgICAgICAgICAgICAgICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnczM6R2V0T2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3MzOlB1dE9iamVjdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzMzpEZWxldGVPYmplY3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnczM6TGlzdEJ1Y2tldCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpZDogJ1MzRGF0YVN0b3JhZ2UnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QoYWdlbnQuYWdlbnROYW1lKS50b0JlKCd0ZXN0LWFnZW50Jyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgSUFNIHBvbGljaWVzIHdpdGgga25vd2xlZGdlIGJhc2UgcGVybWlzc2lvbnMgd2hlbiBuZWVkZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IEJlZHJvY2tLbm93bGVkZ2VCYXNlKHN0YWNrLCAnVGVzdEtCJywge1xuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0LWtiJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3Qga25vd2xlZGdlIGJhc2UnLFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZVByZWZpeGVzOiBbJ2RvY3VtZW50cy8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnVXNlIHRoaXMga25vd2xlZGdlIGJhc2UgZm9yIHRlc3RpbmcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnQgPSBuZXcgQmVkcm9ja0FnZW50Q29yZVJ1bnRpbWVBZ2VudChzdGFjaywgJ1Rlc3RBZ2VudCcsIHtcbiAgICAgICAgICAgICAgICBhZ2VudE5hbWU6ICd0ZXN0LWFnZW50JyxcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbjogJ1lvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCB3aXRoIGtub3dsZWRnZSBiYXNlIGFjY2VzcycsXG4gICAgICAgICAgICAgICAgcHJvamVjdFJvb3Q6ICcuL3Rlc3QtcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgczNCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgczNQcmVmaXg6ICdhZ2VudC1kYXRhLycsXG4gICAgICAgICAgICAgICAga25vd2xlZGdlQmFzZXM6IFtrbm93bGVkZ2VCYXNlXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IGFnZW50IGhhcyBrbm93bGVkZ2UgYmFzZSBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgICAgICAgICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgICAgICAgICAgIFN0YXRlbWVudDogTWF0Y2guYXJyYXlXaXRoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3Rpb246IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JlZHJvY2s6UmV0cmlldmUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYmVkcm9jazpSZXRyaWV2ZUFuZEdlbmVyYXRlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIHBlcm1pc3Npb25zIGZvciBrbm93bGVkZ2UgYmFzZSBhY2Nlc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIE1hdGNoLm9iamVjdExpa2Uoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3Rpb246ICdhb3NzOkFQSUFjY2Vzc0FsbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChhZ2VudC5hZ2VudE5hbWUpLnRvQmUoJ3Rlc3QtYWdlbnQnKTtcbiAgICAgICAgICAgIGV4cGVjdChrbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VOYW1lKS50b0JlKCd0ZXN0LWtiJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUga25vd2xlZGdlIGJhc2UgSUFNIHBvbGljaWVzIHdpdGggbWluaW1hbCBwZXJtaXNzaW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdUZXN0S0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3Qta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jdW1lbnRzLycsICdwb2xpY2llcy8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnVXNlIHRoaXMga25vd2xlZGdlIGJhc2UgZm9yIHRlc3RpbmcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuXG4gICAgICAgICAgICAvLyBWZXJpZnkga25vd2xlZGdlIGJhc2UgZGF0YSBzb3VyY2Ugcm9sZSBoYXMgY29ycmVjdCBwZXJtaXNzaW9uc1xuICAgICAgICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OklBTTo6UG9saWN5Jywge1xuICAgICAgICAgICAgICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgICAgICAgICAgIFN0YXRlbWVudDogTWF0Y2guYXJyYXlXaXRoKFtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJlZHJvY2sgZW1iZWRkaW5nIHBlcm1pc3Npb25zXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRjaC5vYmplY3RMaWtlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiZWRyb2NrOkludm9rZU1vZGVsKicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdiZWRyb2NrOkdldEZvdW5kYXRpb25Nb2RlbCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFMzIHBlcm1pc3Npb25zIHNjb3BlZCB0byBzcGVjaWZpYyBwcmVmaXhlc1xuICAgICAgICAgICAgICAgICAgICAgICAgTWF0Y2gub2JqZWN0TGlrZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFjdGlvbjogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnczM6R2V0T2JqZWN0KicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzMzpHZXRCdWNrZXQqJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3MzOkxpc3QqJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChrbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VOYW1lKS50b0JlKCd0ZXN0LWtiJyk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ1RlbXBsYXRlIFN5bnRoZXNpcyB3aXRoIERpZmZlcmVudCBDb25maWd1cmF0aW9ucycsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtaW5pbWFsIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBtaW5pbWFsIGtub3dsZWRnZSBiYXNlIGZvciB0aGUgYWdlbnRcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdNaW5pbWFsS0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ21pbmltYWwta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTWluaW1hbCBrbm93bGVkZ2UgYmFzZSBmb3IgYWdlbnQgdGVzdGluZycsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnbWluaW1hbC8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnTWluaW1hbCBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnTWluaW1hbEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ21pbmltYWwtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnTWluaW1hbCBjb25maWd1cmF0aW9uIGFnZW50JyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ21pbmltYWwvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuXG4gICAgICAgICAgICAvLyBTaG91bGQgY3JlYXRlIGJhc2ljIHJlc291cmNlcyBpbmNsdWRpbmcgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAgICAgICAgICBjb25zdCByb2xlQ291bnQgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZS5maW5kUmVzb3VyY2VzKCdBV1M6OklBTTo6Um9sZScpKS5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBwb2xpY3lDb3VudCA9IE9iamVjdC5rZXlzKHRlbXBsYXRlLmZpbmRSZXNvdXJjZXMoJ0FXUzo6SUFNOjpQb2xpY3knKSkubGVuZ3RoO1xuICAgICAgICAgICAgZXhwZWN0KHJvbGVDb3VudCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgICAgICAgIGV4cGVjdChwb2xpY3lDb3VudCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQ3VzdG9tOjpBZ2VudENvcmVSdW50aW1lJywgMSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNob3VsZCBjcmVhdGUga25vd2xlZGdlIGJhc2UgcmVzb3VyY2VzXG4gICAgICAgICAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6QmVkcm9jazo6S25vd2xlZGdlQmFzZScsIDEpO1xuICAgICAgICAgICAgdGVtcGxhdGUucmVzb3VyY2VDb3VudElzKCdBV1M6Ok9wZW5TZWFyY2hTZXJ2ZXJsZXNzOjpDb2xsZWN0aW9uJywgMSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChhZ2VudC5hZ2VudE5hbWUpLnRvQmUoJ21pbmltYWwtYWdlbnQnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBtYXhpbXVtIGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrbm93bGVkZ2VCYXNlMSA9IG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShzdGFjaywgJ0tCMScsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAna2ItMScsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdGaXJzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jcy8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnVXNlIGZvciBkb2N1bWVudGF0aW9uJyxcbiAgICAgICAgICAgICAgICBjaHVua2luZ1N0cmF0ZWd5OiB7XG4gICAgICAgICAgICAgICAgICAgIG1heFRva2VuczogMTUwMCxcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmxhcFBlcmNlbnRhZ2U6IDI1XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlbmFibGVJbmdlc3Rpb25BbGFybXM6IHRydWUsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6ICdwcm9kJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UyID0gbmV3IEJlZHJvY2tLbm93bGVkZ2VCYXNlKHN0YWNrLCAnS0IyJywge1xuICAgICAgICAgICAgICAgIG5hbWU6ICdrYi0yJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NlY29uZCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsncG9saWNpZXMvJ10sXG4gICAgICAgICAgICAgICAga25vd2xlZGdlQmFzZUluc3RydWN0aW9uczogJ1VzZSBmb3IgcG9saWNpZXMnLFxuICAgICAgICAgICAgICAgIGNodW5raW5nU3RyYXRlZ3k6IHtcbiAgICAgICAgICAgICAgICAgICAgbWF4VG9rZW5zOiA4MDAsXG4gICAgICAgICAgICAgICAgICAgIG92ZXJsYXBQZXJjZW50YWdlOiAxNVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZW5hYmxlSW5nZXN0aW9uQWxhcm1zOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVudmlyb25tZW50OiAncHJvZCdcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnTWF4aW1hbEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ21heGltYWwtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnTWF4aW1hbCBjb25maWd1cmF0aW9uIGFnZW50IHdpdGggYWxsIGZlYXR1cmVzJyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ21heGltYWwvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2UxLCBrbm93bGVkZ2VCYXNlMl0sXG4gICAgICAgICAgICAgICAgcHJvdG9jb2w6ICdIVFRQUycsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6ICdwcm9kJyxcbiAgICAgICAgICAgICAgICBlbmFibGVUcmFjaW5nOiB0cnVlLFxuICAgICAgICAgICAgICAgIGN1c3RvbVJlc291cmNlVGltZW91dE1pbnV0ZXM6IDIwLFxuICAgICAgICAgICAgICAgIGVudmlyb25tZW50VmFyczoge1xuICAgICAgICAgICAgICAgICAgICAnQ1VTVE9NX1ZBUic6ICdjdXN0b20tdmFsdWUnLFxuICAgICAgICAgICAgICAgICAgICAnREVCVUdfTU9ERSc6ICd0cnVlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XG5cbiAgICAgICAgICAgIC8vIFNob3VsZCBjcmVhdGUgYWxsIHJlc291cmNlc1xuICAgICAgICAgICAgdGVtcGxhdGUucmVzb3VyY2VDb3VudElzKCdBV1M6OkJlZHJvY2s6Oktub3dsZWRnZUJhc2UnLCAyKTtcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpCZWRyb2NrOjpEYXRhU291cmNlJywgMik7XG4gICAgICAgICAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6T3BlblNlYXJjaFNlcnZlcmxlc3M6OkNvbGxlY3Rpb24nLCAyKTtcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpTdGVwRnVuY3Rpb25zOjpTdGF0ZU1hY2hpbmUnLCAyKTtcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpFdmVudHM6OlJ1bGUnLCAyKTtcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIDYpOyAvLyAzIHBlciBLQlxuICAgICAgICAgICAgdGVtcGxhdGUucmVzb3VyY2VDb3VudElzKCdDdXN0b206OkFnZW50Q29yZVJ1bnRpbWUnLCAxKTtcblxuICAgICAgICAgICAgLy8gU2hvdWxkIGhhdmUgcHJvZHVjdGlvbiBsb2cgcmV0ZW50aW9uXG4gICAgICAgICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6TG9nczo6TG9nR3JvdXAnLCB7XG4gICAgICAgICAgICAgICAgUmV0ZW50aW9uSW5EYXlzOiAxODBcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QoYWdlbnQuYWdlbnROYW1lKS50b0JlKCdtYXhpbWFsLWFnZW50Jyk7XG4gICAgICAgICAgICBleHBlY3Qoa25vd2xlZGdlQmFzZTEua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ2tiLTEnKTtcbiAgICAgICAgICAgIGV4cGVjdChrbm93bGVkZ2VCYXNlMi5rbm93bGVkZ2VCYXNlTmFtZSkudG9CZSgna2ItMicpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGRpZmZlcmVudCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIC8vIFRlc3QgZWFjaCBlbnZpcm9ubWVudCBzZXBhcmF0ZWx5IHRvIGF2b2lkIHN5bnRoZXNpcyBjb25mbGljdHNcbiAgICAgICAgICAgIGNvbnN0IHRlc3RFbnZpcm9ubWVudCA9IChlbnY6ICdkZXYnIHwgJ3N0YWdpbmcnIHwgJ3Byb2QnKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW52QXBwID0gbmV3IGNkay5BcHAoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbnZTdGFjayA9IG5ldyBjZGsuU3RhY2soZW52QXBwLCBgJHtlbnZ9U3RhY2tgLCB7XG4gICAgICAgICAgICAgICAgICAgIGVudjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudDogJzEyMzQ1Njc4OTAxMicsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpb246ICd1cy1lYXN0LTEnXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb25zdCBlbnZCdWNrZXQgPSBuZXcgQnVja2V0KGVudlN0YWNrLCAnRW52QnVja2V0Jyk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc3Qga25vd2xlZGdlQmFzZSA9IG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShlbnZTdGFjaywgJ0VudktCJywge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBgJHtlbnZ9LWtiYCxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGAke2Vudn0ga25vd2xlZGdlIGJhc2VgLFxuICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlQnVja2V0OiBlbnZCdWNrZXQsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VQcmVmaXhlczogWydkb2N1bWVudHMvJ10sXG4gICAgICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6IGAke2Vudn0ga25vd2xlZGdlIGJhc2UgaW5zdHJ1Y3Rpb25zYCxcbiAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6IGVudlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYWdlbnQgPSBuZXcgQmVkcm9ja0FnZW50Q29yZVJ1bnRpbWVBZ2VudChlbnZTdGFjaywgJ0VudkFnZW50Jywge1xuICAgICAgICAgICAgICAgICAgICBhZ2VudE5hbWU6IGAke2Vudn0tYWdlbnRgLFxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbjogYCR7ZW52fSBhZ2VudCBpbnN0cnVjdGlvbnNgLFxuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgczNCdWNrZXQ6IGVudkJ1Y2tldCxcbiAgICAgICAgICAgICAgICAgICAgczNQcmVmaXg6IGAke2Vudn0tZGF0YS9gLFxuICAgICAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdLFxuICAgICAgICAgICAgICAgICAgICBlbnZpcm9ubWVudDogZW52XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhlbnZTdGFjayk7XG5cbiAgICAgICAgICAgICAgICAvLyBWZXJpZnkgZW52aXJvbm1lbnQtc3BlY2lmaWMgY29uZmlndXJhdGlvbnNcbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZFJldGVudGlvbiA9IGVudiA9PT0gJ3Byb2QnID8gMTgwIDogZW52ID09PSAnc3RhZ2luZycgPyAzMCA6IDc7XG4gICAgICAgICAgICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkxvZ3M6OkxvZ0dyb3VwJywge1xuICAgICAgICAgICAgICAgICAgICBSZXRlbnRpb25JbkRheXM6IGV4cGVjdGVkUmV0ZW50aW9uXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBQcm9kdWN0aW9uIHNob3VsZCBoYXZlIGFsYXJtcywgZGV2IHNob3VsZCBub3RcbiAgICAgICAgICAgICAgICBjb25zdCBleHBlY3RlZEFsYXJtQ291bnQgPSBlbnYgPT09ICdwcm9kJyA/IDMgOiAwO1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpDbG91ZFdhdGNoOjpBbGFybScsIGV4cGVjdGVkQWxhcm1Db3VudCk7XG5cbiAgICAgICAgICAgICAgICBleHBlY3QoYWdlbnQuYWdlbnROYW1lKS50b0JlKGAke2Vudn0tYWdlbnRgKTtcbiAgICAgICAgICAgICAgICBleHBlY3Qoa25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlTmFtZSkudG9CZShgJHtlbnZ9LWtiYCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvLyBUZXN0IGVhY2ggZW52aXJvbm1lbnRcbiAgICAgICAgICAgIHRlc3RFbnZpcm9ubWVudCgnZGV2Jyk7XG4gICAgICAgICAgICB0ZXN0RW52aXJvbm1lbnQoJ3N0YWdpbmcnKTtcbiAgICAgICAgICAgIHRlc3RFbnZpcm9ubWVudCgncHJvZCcpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdSZXNvdXJjZSBOYW1pbmcgQ29udmVudGlvbnMgYW5kIFRhZ2dpbmcnLCAoKSA9PiB7XG4gICAgICAgIHRlc3QoJ3Nob3VsZCBmb2xsb3cgY29uc2lzdGVudCBuYW1pbmcgY29udmVudGlvbnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IEJlZHJvY2tLbm93bGVkZ2VCYXNlKHN0YWNrLCAnVGVzdEtCJywge1xuICAgICAgICAgICAgICAgIG5hbWU6ICd0ZXN0LWtiJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3Qga25vd2xlZGdlIGJhc2UnLFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZVByZWZpeGVzOiBbJ2RvY3VtZW50cy8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnVXNlIHRoaXMga25vd2xlZGdlIGJhc2UgZm9yIHRlc3RpbmcnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnQgPSBuZXcgQmVkcm9ja0FnZW50Q29yZVJ1bnRpbWVBZ2VudChzdGFjaywgJ1Rlc3RBZ2VudCcsIHtcbiAgICAgICAgICAgICAgICBhZ2VudE5hbWU6ICd0ZXN0LWFnZW50JyxcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbjogJ1lvdSBhcmUgYSBoZWxwZnVsIGFzc2lzdGFudCcsXG4gICAgICAgICAgICAgICAgcHJvamVjdFJvb3Q6ICcuL3Rlc3QtcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgczNCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgczNQcmVmaXg6ICdhZ2VudC1kYXRhLycsXG4gICAgICAgICAgICAgICAga25vd2xlZGdlQmFzZXM6IFtrbm93bGVkZ2VCYXNlXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IElBTSByb2xlIG5hbWluZyBmb2xsb3dzIGNvbnZlbnRpb25cbiAgICAgICAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpJQU06OlJvbGUnLCB7XG4gICAgICAgICAgICAgICAgUm9sZU5hbWU6IE1hdGNoLmFic2VudCgpIC8vIFNob3VsZCB1c2UgQ0RLIGdlbmVyYXRlZCBuYW1lc1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBrbm93bGVkZ2UgYmFzZSBuYW1pbmcgKENESyBnZW5lcmF0ZXMgdW5pcXVlIG5hbWVzKVxuICAgICAgICAgICAgdGVtcGxhdGUuaGFzUmVzb3VyY2VQcm9wZXJ0aWVzKCdBV1M6OkJlZHJvY2s6Oktub3dsZWRnZUJhc2UnLCB7XG4gICAgICAgICAgICAgICAgTmFtZTogTWF0Y2guc3RyaW5nTGlrZVJlZ2V4cCgnXi4qdGVzdC1rYi4qJCcpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IE9wZW5TZWFyY2ggY29sbGVjdGlvbiBuYW1pbmcgZm9sbG93cyBjb252ZW50aW9uXG4gICAgICAgICAgICB0ZW1wbGF0ZS5oYXNSZXNvdXJjZVByb3BlcnRpZXMoJ0FXUzo6T3BlblNlYXJjaFNlcnZlcmxlc3M6OkNvbGxlY3Rpb24nLCB7XG4gICAgICAgICAgICAgICAgTmFtZTogTWF0Y2guc3RyaW5nTGlrZVJlZ2V4cCgnXnZlY3RvcnN0b3JlLiokJylcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBWZXJpZnkgU3RlcCBGdW5jdGlvbnMgc3RhdGUgbWFjaGluZSBuYW1pbmdcbiAgICAgICAgICAgIHRlbXBsYXRlLmhhc1Jlc291cmNlUHJvcGVydGllcygnQVdTOjpTdGVwRnVuY3Rpb25zOjpTdGF0ZU1hY2hpbmUnLCB7XG4gICAgICAgICAgICAgICAgU3RhdGVNYWNoaW5lTmFtZTogTWF0Y2guc3RyaW5nTGlrZVJlZ2V4cCgnLippbmdlc3Rpb24uKicpXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KGFnZW50LmFnZW50TmFtZSkudG9CZSgndGVzdC1hZ2VudCcpO1xuICAgICAgICAgICAgZXhwZWN0KGtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIGFwcGx5IGNvbnNpc3RlbnQgcmVzb3VyY2UgdGFnZ2luZycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdUZXN0S0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3Qta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jdW1lbnRzLyddLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6ICdVc2UgdGhpcyBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZycsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6ICdwcm9kJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gbmV3IEJlZHJvY2tBZ2VudENvcmVSdW50aW1lQWdlbnQoc3RhY2ssICdUZXN0QWdlbnQnLCB7XG4gICAgICAgICAgICAgICAgYWdlbnROYW1lOiAndGVzdC1hZ2VudCcsXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb246ICdZb3UgYXJlIGEgaGVscGZ1bCBhc3Npc3RhbnQnLFxuICAgICAgICAgICAgICAgIHByb2plY3RSb290OiAnLi90ZXN0LXByb2plY3QnLFxuICAgICAgICAgICAgICAgIHMzQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgIHMzUHJlZml4OiAnYWdlbnQtZGF0YS8nLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VzOiBba25vd2xlZGdlQmFzZV0sXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6ICdwcm9kJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlID0gVGVtcGxhdGUuZnJvbVN0YWNrKHN0YWNrKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IHJlc291cmNlcyBoYXZlIGFwcHJvcHJpYXRlIHRhZ3MgKG5vdGU6IG5vdCBhbGwgcmVzb3VyY2VzIHN1cHBvcnQgdGFncylcbiAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIGtub3dsZWRnZSBiYXNlIGhhcyB0YWdzIGlmIHRoZXkgYXJlIHN1cHBvcnRlZFxuICAgICAgICAgICAgY29uc3Qga2JSZXNvdXJjZXMgPSB0ZW1wbGF0ZS5maW5kUmVzb3VyY2VzKCdBV1M6OkJlZHJvY2s6Oktub3dsZWRnZUJhc2UnKTtcbiAgICAgICAgICAgIGNvbnN0IGtiS2V5cyA9IE9iamVjdC5rZXlzKGtiUmVzb3VyY2VzKTtcbiAgICAgICAgICAgIGlmIChrYktleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIEtub3dsZWRnZSBiYXNlcyBtYXkgb3IgbWF5IG5vdCBoYXZlIHRhZ3MgZGVwZW5kaW5nIG9uIHRoZSBDREsgdmVyc2lvblxuICAgICAgICAgICAgICAgIC8vIEp1c3QgdmVyaWZ5IHRoZSByZXNvdXJjZSBleGlzdHMgd2l0aCB0aGUgZXhwZWN0ZWQgcHJvcGVydGllc1xuICAgICAgICAgICAgICAgIGV4cGVjdChrYlJlc291cmNlc1trYktleXNbMF1dLlByb3BlcnRpZXMpLnRvSGF2ZVByb3BlcnR5KCdOYW1lJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGtiUmVzb3VyY2VzW2tiS2V5c1swXV0uUHJvcGVydGllcykudG9IYXZlUHJvcGVydHkoJ0Rlc2NyaXB0aW9uJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGV4cGVjdChhZ2VudC5hZ2VudE5hbWUpLnRvQmUoJ3Rlc3QtYWdlbnQnKTtcbiAgICAgICAgICAgIGV4cGVjdChrbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VOYW1lKS50b0JlKCd0ZXN0LWtiJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgcmVzb3VyY2UgbmFtaW5nIGNvbmZsaWN0cyBncmFjZWZ1bGx5JywgKCkgPT4ge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIG11bHRpcGxlIGtub3dsZWRnZSBiYXNlcyB3aXRoIHNpbWlsYXIgbmFtZXNcbiAgICAgICAgICAgIGNvbnN0IGtiMSA9IG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShzdGFjaywgJ0tCMScsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGVzdC1rYicsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdGaXJzdCB0ZXN0IGtub3dsZWRnZSBiYXNlJyxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VQcmVmaXhlczogWydkb2NzMS8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnRmlyc3QgS0IgaW5zdHJ1Y3Rpb25zJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IGtiMiA9IG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShzdGFjaywgJ0tCMicsIHtcbiAgICAgICAgICAgICAgICBuYW1lOiAndGVzdC1rYi0yJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NlY29uZCB0ZXN0IGtub3dsZWRnZSBiYXNlJyxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgIGRhdGFTb3VyY2VQcmVmaXhlczogWydkb2NzMi8nXSxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlSW5zdHJ1Y3Rpb25zOiAnU2Vjb25kIEtCIGluc3RydWN0aW9ucydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnVGVzdEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ3Rlc3QtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnQWdlbnQgd2l0aCBtdWx0aXBsZSBzaW1pbGFyIEtCcycsXG4gICAgICAgICAgICAgICAgcHJvamVjdFJvb3Q6ICcuL3Rlc3QtcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgczNCdWNrZXQ6IHRlc3RCdWNrZXQsXG4gICAgICAgICAgICAgICAgczNQcmVmaXg6ICdhZ2VudC1kYXRhLycsXG4gICAgICAgICAgICAgICAga25vd2xlZGdlQmFzZXM6IFtrYjEsIGtiMl1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZSA9IFRlbXBsYXRlLmZyb21TdGFjayhzdGFjayk7XG5cbiAgICAgICAgICAgIC8vIFNob3VsZCBjcmVhdGUgYm90aCBrbm93bGVkZ2UgYmFzZXMgd2l0aCB1bmlxdWUgcmVzb3VyY2UgbmFtZXNcbiAgICAgICAgICAgIHRlbXBsYXRlLnJlc291cmNlQ291bnRJcygnQVdTOjpCZWRyb2NrOjpLbm93bGVkZ2VCYXNlJywgMik7XG4gICAgICAgICAgICB0ZW1wbGF0ZS5yZXNvdXJjZUNvdW50SXMoJ0FXUzo6T3BlblNlYXJjaFNlcnZlcmxlc3M6OkNvbGxlY3Rpb24nLCAyKTtcblxuICAgICAgICAgICAgLy8gVmVyaWZ5IHVuaXF1ZSBjb2xsZWN0aW9uIG5hbWVzXG4gICAgICAgICAgICBjb25zdCBjb2xsZWN0aW9ucyA9IHRlbXBsYXRlLmZpbmRSZXNvdXJjZXMoJ0FXUzo6T3BlblNlYXJjaFNlcnZlcmxlc3M6OkNvbGxlY3Rpb24nKTtcbiAgICAgICAgICAgIGNvbnN0IGNvbGxlY3Rpb25OYW1lcyA9IE9iamVjdC52YWx1ZXMoY29sbGVjdGlvbnMpLm1hcChcbiAgICAgICAgICAgICAgICAoY29sbGVjdGlvbjogYW55KSA9PiBjb2xsZWN0aW9uLlByb3BlcnRpZXMuTmFtZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gTmFtZXMgc2hvdWxkIGJlIGRpZmZlcmVudFxuICAgICAgICAgICAgZXhwZWN0KGNvbGxlY3Rpb25OYW1lc1swXSkubm90LnRvQmUoY29sbGVjdGlvbk5hbWVzWzFdKTtcbiAgICAgICAgICAgIGV4cGVjdChjb2xsZWN0aW9uTmFtZXNbMF0pLnRvTWF0Y2goL152ZWN0b3JzdG9yZS4qJC8pO1xuICAgICAgICAgICAgZXhwZWN0KGNvbGxlY3Rpb25OYW1lc1sxXSkudG9NYXRjaCgvXnZlY3RvcnN0b3JlLiokLyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChhZ2VudC5hZ2VudE5hbWUpLnRvQmUoJ3Rlc3QtYWdlbnQnKTtcbiAgICAgICAgICAgIGV4cGVjdChrYjEua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2InKTtcbiAgICAgICAgICAgIGV4cGVjdChrYjIua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2ItMicpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdDbG91ZEZvcm1hdGlvbiBUZW1wbGF0ZSBTdHJ1Y3R1cmUgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIGdlbmVyYXRlIHZhbGlkIENsb3VkRm9ybWF0aW9uIHRlbXBsYXRlIHN0cnVjdHVyZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdUZXN0S0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3Qta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jdW1lbnRzLyddLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6ICdVc2UgdGhpcyBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnVGVzdEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ3Rlc3QtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ2FnZW50LWRhdGEvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVKc29uID0gdGVtcGxhdGUudG9KU09OKCk7XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSB0ZW1wbGF0ZSBoYXMgcmVxdWlyZWQgc2VjdGlvbnMgKENESyB0ZW1wbGF0ZXMgZG9uJ3QgYWx3YXlzIGhhdmUgQVdTVGVtcGxhdGVGb3JtYXRWZXJzaW9uKVxuICAgICAgICAgICAgZXhwZWN0KHRlbXBsYXRlSnNvbikudG9IYXZlUHJvcGVydHkoJ1Jlc291cmNlcycpO1xuICAgICAgICAgICAgZXhwZWN0KHRlbXBsYXRlSnNvbikudG9IYXZlUHJvcGVydHkoJ1BhcmFtZXRlcnMnKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ0RLIHRlbXBsYXRlcyBtYXkgaGF2ZSBhZGRpdGlvbmFsIHNlY3Rpb25zXG4gICAgICAgICAgICBpZiAodGVtcGxhdGVKc29uLkFXU1RlbXBsYXRlRm9ybWF0VmVyc2lvbikge1xuICAgICAgICAgICAgICAgIGV4cGVjdCh0ZW1wbGF0ZUpzb24uQVdTVGVtcGxhdGVGb3JtYXRWZXJzaW9uKS50b0JlKCcyMDEwLTA5LTA5Jyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBubyBoYXJkY29kZWQgdmFsdWVzIGluIHRlbXBsYXRlXG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHRlbXBsYXRlSnNvbik7XG4gICAgICAgICAgICBleHBlY3QodGVtcGxhdGVTdHJpbmcpLm5vdC50b01hdGNoKC8xMjM0NTY3ODkwMTIvKTsgLy8gTm8gaGFyZGNvZGVkIGFjY291bnQgSURzXG4gICAgICAgICAgICBleHBlY3QodGVtcGxhdGVTdHJpbmcpLm5vdC50b01hdGNoKC91cy1lYXN0LTEvKTsgLy8gTm8gaGFyZGNvZGVkIHJlZ2lvbnMgKGV4Y2VwdCBpbiBBUk5zKVxuXG4gICAgICAgICAgICAvLyBWZXJpZnkgYWxsIHJlc291cmNlcyBoYXZlIHByb3BlciBkZXBlbmRlbmNpZXNcbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRlbXBsYXRlSnNvbi5SZXNvdXJjZXM7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyZXNvdXJjZXMpLmZvckVhY2gocmVzb3VyY2VLZXkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc291cmNlID0gcmVzb3VyY2VzW3Jlc291cmNlS2V5XTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBJQU0gcG9saWNpZXMgc2hvdWxkIGRlcGVuZCBvbiByb2xlc1xuICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZS5UeXBlID09PSAnQVdTOjpJQU06OlBvbGljeScpIHtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KHJlc291cmNlLlByb3BlcnRpZXMuUm9sZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQ3VzdG9tIHJlc291cmNlcyBzaG91bGQgaGF2ZSBwcm9wZXIgc2VydmljZSB0b2tlbnNcbiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2UuVHlwZS5zdGFydHNXaXRoKCdDdXN0b206OicpKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChyZXNvdXJjZS5Qcm9wZXJ0aWVzLlNlcnZpY2VUb2tlbikudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KGFnZW50LmFnZW50TmFtZSkudG9CZSgndGVzdC1hZ2VudCcpO1xuICAgICAgICAgICAgZXhwZWN0KGtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZU5hbWUpLnRvQmUoJ3Rlc3Qta2InKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIHJlc291cmNlIGRlcGVuZGVuY2llcyBhcmUgY29ycmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgQmVkcm9ja0tub3dsZWRnZUJhc2Uoc3RhY2ssICdUZXN0S0InLCB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ3Rlc3Qta2InLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBrbm93bGVkZ2UgYmFzZScsXG4gICAgICAgICAgICAgICAgZGF0YVNvdXJjZUJ1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFsnZG9jdW1lbnRzLyddLFxuICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6ICdVc2UgdGhpcyBrbm93bGVkZ2UgYmFzZSBmb3IgdGVzdGluZydcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBhZ2VudCA9IG5ldyBCZWRyb2NrQWdlbnRDb3JlUnVudGltZUFnZW50KHN0YWNrLCAnVGVzdEFnZW50Jywge1xuICAgICAgICAgICAgICAgIGFnZW50TmFtZTogJ3Rlc3QtYWdlbnQnLFxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uOiAnWW91IGFyZSBhIGhlbHBmdWwgYXNzaXN0YW50JyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ2FnZW50LWRhdGEvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczogW2tub3dsZWRnZUJhc2VdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVKc29uID0gdGVtcGxhdGUudG9KU09OKCk7XG5cbiAgICAgICAgICAgIC8vIEZpbmQgZGF0YSBzb3VyY2UgcmVzb3VyY2VcbiAgICAgICAgICAgIGNvbnN0IGRhdGFTb3VyY2VLZXkgPSBPYmplY3Qua2V5cyh0ZW1wbGF0ZUpzb24uUmVzb3VyY2VzKS5maW5kKFxuICAgICAgICAgICAgICAgIGtleSA9PiB0ZW1wbGF0ZUpzb24uUmVzb3VyY2VzW2tleV0uVHlwZSA9PT0gJ0FXUzo6QmVkcm9jazo6RGF0YVNvdXJjZSdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChkYXRhU291cmNlS2V5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IHRlbXBsYXRlSnNvbi5SZXNvdXJjZXNbZGF0YVNvdXJjZUtleV07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gRGF0YSBzb3VyY2Ugc2hvdWxkIGRlcGVuZCBvbiBrbm93bGVkZ2UgYmFzZVxuICAgICAgICAgICAgICAgIGV4cGVjdChkYXRhU291cmNlLlByb3BlcnRpZXMuS25vd2xlZGdlQmFzZUlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFNob3VsZCBoYXZlIHByb3BlciBTMyBjb25maWd1cmF0aW9uXG4gICAgICAgICAgICAgICAgZXhwZWN0KGRhdGFTb3VyY2UuUHJvcGVydGllcy5EYXRhU291cmNlQ29uZmlndXJhdGlvbi5TM0NvbmZpZ3VyYXRpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEZpbmQgU3RlcCBGdW5jdGlvbnMgc3RhdGUgbWFjaGluZVxuICAgICAgICAgICAgY29uc3Qgc3RhdGVNYWNoaW5lS2V5ID0gT2JqZWN0LmtleXModGVtcGxhdGVKc29uLlJlc291cmNlcykuZmluZChcbiAgICAgICAgICAgICAgICBrZXkgPT4gdGVtcGxhdGVKc29uLlJlc291cmNlc1trZXldLlR5cGUgPT09ICdBV1M6OlN0ZXBGdW5jdGlvbnM6OlN0YXRlTWFjaGluZSdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChzdGF0ZU1hY2hpbmVLZXkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0ZU1hY2hpbmUgPSB0ZW1wbGF0ZUpzb24uUmVzb3VyY2VzW3N0YXRlTWFjaGluZUtleV07XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gU3RhdGUgbWFjaGluZSBzaG91bGQgaGF2ZSBwcm9wZXIgSUFNIHJvbGVcbiAgICAgICAgICAgICAgICBleHBlY3Qoc3RhdGVNYWNoaW5lLlByb3BlcnRpZXMuUm9sZUFybikudG9CZURlZmluZWQoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBTaG91bGQgaGF2ZSBkZWZpbml0aW9uIChtYXkgYmUgaW5saW5lIG9yIHJlZmVyZW5jZWQpXG4gICAgICAgICAgICAgICAgZXhwZWN0KHN0YXRlTWFjaGluZS5Qcm9wZXJ0aWVzKS50b0hhdmVQcm9wZXJ0eSgnRGVmaW5pdGlvblN0cmluZycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBleHBlY3QoYWdlbnQuYWdlbnROYW1lKS50b0JlKCd0ZXN0LWFnZW50Jyk7XG4gICAgICAgICAgICBleHBlY3Qoa25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlTmFtZSkudG9CZSgndGVzdC1rYicpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgdGVtcGxhdGUgc2l6ZSBhbmQgY29tcGxleGl0eSBsaW1pdHMnLCAoKSA9PiB7XG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBjb21wbGV4IHN0YWNrIHRvIHRlc3QgdGVtcGxhdGUgbGltaXRzXG4gICAgICAgICAgICBjb25zdCBrbm93bGVkZ2VCYXNlcyA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlcy5wdXNoKG5ldyBCZWRyb2NrS25vd2xlZGdlQmFzZShzdGFjaywgYEtCJHtpfWAsIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogYGtiLSR7aX1gLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYEtub3dsZWRnZSBiYXNlICR7aX1gLFxuICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlQnVja2V0OiB0ZXN0QnVja2V0LFxuICAgICAgICAgICAgICAgICAgICBkYXRhU291cmNlUHJlZml4ZXM6IFtgZG9jcyR7aX0vYF0sXG4gICAgICAgICAgICAgICAgICAgIGtub3dsZWRnZUJhc2VJbnN0cnVjdGlvbnM6IGBJbnN0cnVjdGlvbnMgZm9yIEtCICR7aX1gLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVJbmdlc3Rpb25BbGFybXM6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gbmV3IEJlZHJvY2tBZ2VudENvcmVSdW50aW1lQWdlbnQoc3RhY2ssICdDb21wbGV4QWdlbnQnLCB7XG4gICAgICAgICAgICAgICAgYWdlbnROYW1lOiAnY29tcGxleC1hZ2VudCcsXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb246ICdDb21wbGV4IGFnZW50IHdpdGggbXVsdGlwbGUga25vd2xlZGdlIGJhc2VzJyxcbiAgICAgICAgICAgICAgICBwcm9qZWN0Um9vdDogJy4vdGVzdC1wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICBzM0J1Y2tldDogdGVzdEJ1Y2tldCxcbiAgICAgICAgICAgICAgICBzM1ByZWZpeDogJ2NvbXBsZXgtYWdlbnQvJyxcbiAgICAgICAgICAgICAgICBrbm93bGVkZ2VCYXNlczoga25vd2xlZGdlQmFzZXMsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnQ6ICdwcm9kJyxcbiAgICAgICAgICAgICAgICBlbmFibGVUcmFjaW5nOiB0cnVlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGUgPSBUZW1wbGF0ZS5mcm9tU3RhY2soc3RhY2spO1xuICAgICAgICAgICAgY29uc3QgdGVtcGxhdGVKc29uID0gdGVtcGxhdGUudG9KU09OKCk7XG4gICAgICAgICAgICBjb25zdCB0ZW1wbGF0ZVN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHRlbXBsYXRlSnNvbik7XG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSB0ZW1wbGF0ZSBpcyB3aXRoaW4gQ2xvdWRGb3JtYXRpb24gbGltaXRzXG4gICAgICAgICAgICBleHBlY3QodGVtcGxhdGVTdHJpbmcubGVuZ3RoKS50b0JlTGVzc1RoYW4oMTAwMDAwMCk7IC8vIDFNQiBsaW1pdFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBWZXJpZnkgcmVzb3VyY2UgY291bnQgaXMgcmVhc29uYWJsZVxuICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VDb3VudCA9IE9iamVjdC5rZXlzKHRlbXBsYXRlSnNvbi5SZXNvdXJjZXMpLmxlbmd0aDtcbiAgICAgICAgICAgIGV4cGVjdChyZXNvdXJjZUNvdW50KS50b0JlTGVzc1RoYW4oNTAwKTsgLy8gQ2xvdWRGb3JtYXRpb24gbGltaXQgaXMgNTAwXG5cbiAgICAgICAgICAgIC8vIFZlcmlmeSBubyBjaXJjdWxhciBkZXBlbmRlbmNpZXNcbiAgICAgICAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRlbXBsYXRlSnNvbi5SZXNvdXJjZXM7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhyZXNvdXJjZXMpLmZvckVhY2gocmVzb3VyY2VLZXkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc291cmNlID0gcmVzb3VyY2VzW3Jlc291cmNlS2V5XTtcbiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2UuRGVwZW5kc09uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IEFycmF5LmlzQXJyYXkocmVzb3VyY2UuRGVwZW5kc09uKSBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gcmVzb3VyY2UuRGVwZW5kc09uIFxuICAgICAgICAgICAgICAgICAgICAgICAgOiBbcmVzb3VyY2UuRGVwZW5kc09uXTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIFJlc291cmNlIHNob3VsZCBub3QgZGVwZW5kIG9uIGl0c2VsZlxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZGVwZW5kZW5jaWVzKS5ub3QudG9Db250YWluKHJlc291cmNlS2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZXhwZWN0KGFnZW50LmFnZW50TmFtZSkudG9CZSgnY29tcGxleC1hZ2VudCcpO1xuICAgICAgICAgICAgZXhwZWN0KGtub3dsZWRnZUJhc2VzLmxlbmd0aCkudG9CZSgzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTsiXX0=